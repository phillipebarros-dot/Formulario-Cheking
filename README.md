# Formul√°rio de Checking - OpusM√∫ltipla

![Status do Projeto](https://img.shields.io/badge/status-ativo-brightgreen)
![n8n](https://img.shields.io/badge/n8n-1.110.1%2B-blueviolet)
![Google Sheets](https://img.shields.io/badge/Google-Sheets-green)
![Google Drive](https://img.shields.io/badge/Google-Drive-yellow)

Este reposit√≥rio cont√©m o c√≥digo-fonte e a documenta√ß√£o completa do formul√°rio para submiss√£o de checkings da OpusM√∫ltipla. O projeto integra uma interface de usu√°rio simples com um robusto workflow de automa√ß√£o em n8n para otimizar e garantir a confiabilidade de todo o processo.

## üöÄ O Projeto

O objetivo principal deste projeto √© automatizar o processo de "Checking" de Propostas de Inser√ß√£o (PIs), resolvendo os gargalos do fluxo de trabalho manual. A solu√ß√£o substitui a troca de e-mails e a valida√ß√£o manual por um sistema centralizado que garante a integridade dos dados, organiza os arquivos de forma autom√°tica e notifica as equipes em tempo real, aumentando a efici√™ncia, a rastreabilidade e a confiabilidade da opera√ß√£o.

## ‚ú® Principais Funcionalidades

* **Auto-preenchimento Inteligente:** Ao digitar o n√∫mero da PI, o formul√°rio consulta a planilha de refer√™ncia em tempo real e preenche automaticamente os campos de Cliente, Campanha, Produto, Per√≠odo, Ve√≠culo e Meio, reduzindo a digita√ß√£o e prevenindo erros.
* **Valida√ß√£o de Dados na Origem:** O sistema valida m√∫ltiplas regras de neg√≥cio antes de aceitar o envio:
    * Verifica se a PI existe no banco de dados.
    * Confere se o status da PI √© "ativa".
    * Valida a quantidade m√≠nima de arquivos necess√°rios com base no tipo de ve√≠culo selecionado.
* **Organiza√ß√£o Autom√°tica e Centralizada:** Os comprovantes enviados s√£o salvos automaticamente em uma pasta espec√≠fica no Google Drive, nomeada dinamicamente com o n√∫mero da PI (ex: `PI_103061`), eliminando a necessidade de organiza√ß√£o manual.
* **Notifica√ß√µes Imediatas:** Uma notifica√ß√£o por e-mail √© disparada para as equipes respons√°veis assim que um checking √© validado e processado, garantindo que todos estejam cientes e que os pr√≥ximos passos possam ser tomados sem demora.
* **Registro de Log e Auditoria:** Cada envio bem-sucedido √© registrado com data e hora em uma aba espec√≠fica da planilha, criando um hist√≥rico completo e facilmente audit√°vel de todas as opera√ß√µes.

## üõ†Ô∏è Tecnologias Utilizadas

* üé® **Front-end:** HTML5, CSS3, JavaScript (Vanilla)
* ‚öôÔ∏è **Orquestra√ß√£o e Automa√ß√£o:** n8n (Self-Hosted v1.110.1+)
* üíæ **Fonte de Dados e Armazenamento:** Google Sheets e Google Drive
* ‚òÅÔ∏è **Hospedagem do Formul√°rio:** GitHub Pages

## üåê Como Usar

1.  Acesse o formul√°rio hospedado online:
    **[https://phillipebarros-dot.github.io/Formulario-Cheking/](https://phillipebarros-dot.github.io/Formulario-Cheking/)**
2.  Digite o n√∫mero da PI no campo correspondente e aguarde o preenchimento autom√°tico dos dados.
3.  Preencha os campos restantes (Nome, E-mail, Telefone) e anexe os arquivos de comprova√ß√£o.
4.  Clique em "Enviar". O sistema cuidar√° de todo o resto e exibir√° uma mensagem de sucesso ou erro.

## ü§ñ Como Funciona a Automa√ß√£o (n8n)

O formul√°rio se comunica com um workflow no n8n que executa a seguinte sequ√™ncia l√≥gica:

`Formul√°rio envia dados para a URL do n8n`
‚ûî **1. Webhook (Recebe):** Captura a requisi√ß√£o do formul√°rio.
‚ûî **2. Identificar A√ß√£o (Function):** Analisa os dados e cria a vari√°vel "tipo" (`buscar_pi` ou `submissao`).
‚ûî **3. IF A√ß√£o (Roteamento):** Direciona o fluxo com base no "tipo".

| Rota de Busca (`buscar_pi`)                               | Rota de Envio (`submissao`)                                     |
| --------------------------------------------------------- | --------------------------------------------------------------- |
| ‚ûî **4a. Buscar PI (Google Sheets):** Procura a PI na base. | ‚ûî **4b. Buscar PI (Google Sheets):** Valida se a PI existe.      |
| ‚ûî **5a. Montar Resposta (Function):** Formata os dados.     | ‚ûî **5b. Verificar PI Existe (IF):** Para se a PI n√£o for encontrada. |
| ‚ûî **6a. Responder p/ Webhook:** Envia os dados de volta.   | ‚ûî **6b. Validar Status (Function):** Para se a PI n√£o estiver "ativa". |
|                                                           | ‚ûî **7b. Validar Anexos (IFs + Function):** Confere qtd. de arquivos. |
|                                                           | ‚ûî **8b. Criar Pasta (Google Drive):** Cria uma pasta para a PI.    |
|                                                           | ‚ûî **9b. Upload Arquivos (Google Drive):** Salva os comprovantes.  |
|                                                           | ‚ûî **10b. Registrar Log (Google Sheets):** Adiciona linha de auditoria. |
|                                                           | ‚ûî **11b. Enviar Notifica√ß√£o (Email):** Envia e-mail de confirma√ß√£o.  |
|                                                           | ‚ûî **12b. Responder Sucesso:** Envia mensagem final ao formul√°rio.   |

## üë®‚Äçüíª Para Desenvolvedores

### Comunica√ß√£o Front-end <> n8n

O arquivo `index.html` se comunica com o n8n atrav√©s de duas a√ß√µes distintas para o mesmo endpoint do Webhook:

1.  **Busca de PI:** Uma requisi√ß√£o `POST` com `Content-Type: application/json` e o corpo: `{ "action": "buscar_pi", "n_pi": "..." }`.
2.  **Submiss√£o de Formul√°rio:** Uma requisi√ß√£o `POST` com `Content-Type: multipart/form-data`, contendo todos os campos do formul√°rio e os arquivos.

### Configura√ß√£o Essencial do n8n (CORS)

Como o formul√°rio est√° em um dom√≠nio (`phillipebarros-dot.github.io`) e a automa√ß√£o em outro (`n8n.grupoom.com.br`), √© **obrigat√≥rio** configurar o CORS no servidor n8n para permitir a comunica√ß√£o. Adicione as seguintes vari√°veis de ambiente √† sua configura√ß√£o do n8n (ex: `docker-compose.yml` ou `.env`):

```bash
# Permite que o seu formul√°rio no GitHub Pages fa√ßa requisi√ß√µes.
N8N_CORS_ALLOWED_ORIGINS=[https://phillipebarros-dot.github.io](https://phillipebarros-dot.github.io)

# Permite os m√©todos HTTP necess√°rios para a busca (POST) e verifica√ß√£o (OPTIONS).
N8N_CORS_ALLOWED_METHODS=GET,HEAD,POST,PUT,PATCH,DELETE,OPTIONS

# Permite os cabe√ßalhos que o navegador envia durante a comunica√ß√£o.
N8N_CORS_ALLOWED_HEADERS=Origin,X-Requested-With,Content-Type,Accept,Authorization,X-N8N-API-KEY
Importante: Lembre-se de reiniciar sua inst√¢ncia do n8n ap√≥s adicionar ou alterar essas vari√°veis para que as mudan√ßas tenham efeito.

Dom√≠nio Personalizado
Para usar um dom√≠nio da empresa (ex: checking.grupoom.com.br), s√£o necess√°rios dois passos:

DNS: Criar um registro CNAME no provedor de dom√≠nio apontando o subdom√≠nio desejado para phillipebarros-dot.github.io..

GitHub: Adicionar o dom√≠nio personalizado nas configura√ß√µes do reposit√≥rio no GitHub Pages (Settings > Pages > Custom domain).

Se voc√™ configurar um dom√≠nio personalizado, lembre-se de atualizar a vari√°vel N8N_CORS_ALLOWED_ORIGINS com o novo endere√ßo (ex: https://checking.grupoom.com.br).

üîó Links √öteis
Planilha de Refer√™ncia: Google Sheets (Acesso restrito)

Painel do n8n: https://n8n.grupoom.com.br

Reposit√≥rio do Projeto: GitHub
