<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checking OpusMÃºltipla</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --azul-om: #0033a0;
            --cinza-escuro: #1a202c;
            --cinza-medio: #4a5568;
            --cinza-claro: #cbd5e0;
            --cinza-bg: #f7fafc;
            --branco: #ffffff;
            --borda: #e2e8f0;
            --sombra: rgba(0, 0, 0, 0.05);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--cinza-bg);
            color: var(--cinza-escuro);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .main-content {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 4rem 1.5rem;
            flex: 1;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: var(--branco);
            border-radius: 2px;
            box-shadow: 0 1px 2px var(--sombra);
            position: relative;
            overflow: hidden;
            padding: 4rem 5rem;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, 
                #ef4444 0%, 
                #f59e0b 14.28%, 
                #eab308 28.56%,
                #10b981 42.84%, 
                #06b6d4 57.12%,
                #3b82f6 71.4%, 
                #8b5cf6 85.68%, 
                #ec4899 100%
            );
        }
        
        .header {
            text-align: center;
            margin-bottom: 4rem;
            padding-bottom: 3rem;
            border-bottom: 1px solid var(--borda);
        }
        
        .header img.logo-opusmultipla {
            max-width: 480px;
            width: 100%;
            height: auto;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--cinza-escuro);
            letter-spacing: 4px;
            text-transform: uppercase;
            margin: 0;
        }
        
        .attention-box {
            margin-bottom: 4rem;
        }
        
        .warning-text {
            background: #fffbeb;
            border: 1px solid #fbbf24;
            border-left: 6px solid #f59e0b;
            color: #92400e;
            padding: 2rem 2.5rem;
            border-radius: 0;
            font-weight: 500;
            text-align: center;
            margin-bottom: 2rem;
            line-height: 1.8;
            font-size: 0.95rem;
        }
        
        .warning-text strong {
            font-weight: 800;
            font-size: 1.05em;
        }
        
        .attention-box img {
            max-width: 100%;
            height: auto;
            display: block;
            border-radius: 0;
            border: 1px solid var(--borda);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        label {
            font-weight: 700;
            margin-bottom: 0.6rem;
            font-size: 0.8rem;
            color: var(--cinza-escuro);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        label svg {
            width: 14px;
            height: 14px;
            stroke: var(--cinza-medio);
            flex-shrink: 0;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            background: var(--branco);
            border: 2px solid var(--borda);
            border-radius: 0;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            color: var(--cinza-escuro);
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
            font-weight: 400;
        }
        
        input:hover, select:hover, textarea:hover {
            border-color: var(--cinza-claro);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--azul-om);
            box-shadow: 0 0 0 3px rgba(0, 51, 160, 0.08);
        }
        
        input::placeholder, textarea::placeholder {
            color: #a0aec0;
            font-weight: 400;
        }
        
        input[readonly], .campo-bloqueado {
            background: #fafafa;
            border-color: var(--borda);
            cursor: not-allowed;
            pointer-events: none;
            color: var(--cinza-medio);
            font-weight: 500;
        }
        
        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%234a5568' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 14px;
            padding-right: 3rem;
            font-weight: 500;
        }
        
        textarea {
            min-height: 140px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .upload-container {
            border: 3px dashed var(--borda);
            padding: 2.5rem;
            border-radius: 0;
            margin-top: 1rem;
            background: #fafafa;
        }
        
        #upload-placeholder {
            color: var(--cinza-medio);
            font-size: 1rem;
            text-align: center;
            padding: 2rem;
            font-weight: 500;
        }
        
        .upload-group {
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--branco);
            border-radius: 0;
            border: 2px solid var(--borda);
        }
        
        .upload-group:last-child {
            margin-bottom: 0;
        }
        
        .upload-group label {
            margin-bottom: 1rem;
        }
        
        input[type="file"] {
            font-size: 0.9rem;
            padding: 0.75rem;
            cursor: pointer;
            border: 2px solid var(--borda);
        }
        
        input[type="file"]::file-selector-button {
            background: var(--azul-om);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0;
            font-weight: 700;
            cursor: pointer;
            margin-right: 1rem;
            transition: background 0.15s ease;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input[type="file"]::file-selector-button:hover {
            background: #00226e;
        }
        
        button[type="submit"] {
            width: 100%;
            padding: 1.4rem 2.5rem;
            background: var(--azul-om);
            color: white;
            font-size: 1.1rem;
            font-weight: 800;
            border: none;
            border-radius: 0;
            cursor: pointer;
            transition: background 0.15s ease;
            margin-top: 3rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        button[type="submit"]:hover {
            background: #00226e;
        }
        
        button[type="submit"]:disabled {
            background: var(--cinza-claro);
            cursor: not-allowed;
        }
        
        .message-box {
            padding: 1.5rem 2rem;
            border-radius: 0;
            margin-top: 2rem;
            display: none;
            text-align: center;
            font-weight: 600;
            border: 2px solid;
        }
        
        #successMessage {
            background: #ecfdf5;
            color: #065f46;
            border-color: #10b981;
        }
        
        #errorMessage {
            background: #fef2f2;
            color: #991b1b;
            border-color: #ef4444;
        }
        
        #piStatus {
            font-size: 0.85rem;
            margin-top: 0.6rem;
            font-weight: 700;
            letter-spacing: 0.3px;
        }
        
        .size-info {
            font-size: 0.85rem;
            color: var(--cinza-medio);
            margin-top: 1rem;
            font-weight: 600;
            padding: 1rem 1.25rem;
            background: #fafafa;
            border-radius: 0;
            border: 1px solid var(--borda);
        }
        
        .size-info strong {
            color: var(--azul-om);
            font-weight: 800;
        }

        .progress-container {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            background: var(--branco);
            border: 3px solid var(--azul-om);
            border-radius: 0;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 40px;
            background: #fafafa;
            border-radius: 0;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--borda);
        }

        .progress-bar {
            height: 100%;
            background: var(--azul-om);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            font-weight: 800;
            font-size: 0.9rem;
            color: var(--cinza-escuro);
            line-height: 40px;
            z-index: 1;
            letter-spacing: 1px;
        }

        .progress-info {
            margin-top: 1.25rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--cinza-medio);
            font-weight: 600;
        }

        .progress-info strong {
            color: var(--azul-om);
            font-weight: 800;
        }
        
        .file-counter {
            font-size: 0.9rem;
            color: var(--azul-om);
            font-weight: 700;
            margin-top: 1.25rem;
            padding: 1rem 1.5rem;
            background: #fafafa;
            border-radius: 0;
            border: 2px solid var(--borda);
        }
        
        .footer-final {
            width: 100%;
            background: #54595F;
            text-align: center;
            padding: 4rem 1.5rem;
            margin-top: auto;
            position: relative;
        }
        
        .footer-final::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, 
                #ef4444 0%, 
                #f59e0b 14.28%, 
                #eab308 28.56%,
                #10b981 42.84%, 
                #06b6d4 57.12%,
                #3b82f6 71.4%, 
                #8b5cf6 85.68%, 
                #ec4899 100%
            );
            top: 0;
            left: 0;
        }
        
        .footer-final .logo-principal {
            font-size: 3rem;
            font-weight: 900;
            color: var(--branco);
            margin-bottom: 0.75rem;
            letter-spacing: 6px;
        }
        
        .footer-final .subtitulo {
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 5px;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2.5rem;
        }
        
        .footer-final .copyright {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 2rem;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 2.5rem 2rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
                letter-spacing: 2px;
            }
            
            .footer-final .logo-principal {
                font-size: 2.25rem;
                letter-spacing: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="container">
            <div class="header">
                <img src="logo-opus.png" alt="Logo OpusMÃºltipla" class="logo-opusmultipla">
                <h1>Checking</h1>
            </div>
            
            <div class="attention-box">
                <div class="warning-text">
                    <strong>IMPORTANTE:</strong> Arquivos atÃ© <strong>500MB</strong> serÃ£o enviados diretamente pelo formulÃ¡rio. Para arquivos maiores, o sistema criarÃ¡ automaticamente uma pasta no Google Drive e vocÃª receberÃ¡ o link por e-mail.<br><br>
                    O nÃ£o envio dos relatÃ³rios de acordo com especificaÃ§Ãµes acarretarÃ¡ no nÃ£o pagamento das veiculaÃ§Ãµes.
                </div>
                <img src="comunicado.jpg" alt="Comunicado sobre relatÃ³rios de veiculaÃ§Ã£o">
            </div>

            <form id="checkingForm" novalidate>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="nome">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                            Seu Nome *
                        </label>
                        <input type="text" id="nome" name="nome" required placeholder="Digite seu nome completo">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                            Seu E-mail *
                        </label>
                        <input type="email" id="email" name="email" required placeholder="seu@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="telefone">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                            Seu Telefone *
                        </label>
                        <input type="tel" id="telefone" name="telefone" required placeholder="(00) 00000-0000">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="pi">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="9" x2="15" y2="9"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
                            NÃºmero da PI *
                        </label>
                        <input type="text" id="pi" name="n_pi" required placeholder="Digite o nÃºmero da PI">
                        <div id="piStatus"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cliente">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                            Cliente
                        </label>
                        <input type="text" id="cliente" name="cliente" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="campanha">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg>
                            Campanha
                        </label>
                        <input type="text" id="campanha" name="campanha" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="produto">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                            Produto
                        </label>
                        <input type="text" id="produto" name="produto" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="periodo">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                            PerÃ­odo
                        </label>
                        <input type="text" id="periodo" name="periodo" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="veiculo">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect><polyline points="17 2 12 7 7 2"></polyline></svg>
                            VeÃ­culo
                        </label>
                        <input type="text" id="veiculo" name="veiculo" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="meio">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                            Meio
                        </label>
                        <select id="meio" name="meio" class="campo-bloqueado">
                            <option value="">Aguardando PI...</option>
                            <option value="AT">Ativacao</option>
                            <option value="BD">Busdoor</option>
                            <option value="CI">Cinema</option>
                            <option value="DO">Digital Out of Home</option>
                            <option value="FL">Frontlight</option>
                            <option value="IN">Internet</option>
                            <option value="JO">Jornal</option>
                            <option value="MO">Metro</option>
                            <option value="ME">Midia Externa</option>
                            <option value="MI">Midia Interna</option>
                            <option value="OD">Outdoor</option>
                            <option value="TP">Patrocinios</option>
                            <option value="RD">Radio</option>
                            <option value="RF">RÃ¡dio FrequÃªncia</option>
                            <option value="RV">Revista</option>
                            <option value="TV">TV</option>
                        </select>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="observacoes">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                            ObservaÃ§Ãµes
                        </label>
                        <textarea id="observacoes" name="observacoes" rows="4" placeholder="Adicione observaÃ§Ãµes sobre os comprovantes"></textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                            Comprovantes *
                        </label>
                        <div class="size-info">Limite: <strong>500MB</strong> total por envio</div>
                        <div id="upload-area-dinamica" class="upload-container">
                            <p id="upload-placeholder">Preencha o nÃºmero da PI para ver os campos de anexo.</p>
                            
                            <div class="upload-group" data-meio="DO" style="display: none;">
                                <label>RelatÃ³rio FotogrÃ¡fico de Todos os Pontos *</label>
                                <input type="file" name="relatorio_fotografico_do" multiple>
                            </div>
                            <div class="upload-group" data-meio="DO" style="display: none;">
                                <label>RelatÃ³rio de ExibiÃ§Ãµes Automatizado *</label>
                                <input type="file" name="relatorio_exibicoes_do" multiple>
                            </div>
                            <div class="upload-group" data-meio="DO" style="display: none;">
                                <label>VÃ­deo Diurno *</label>
                                <input type="file" name="video_diurno_do" multiple>
                            </div>

                            <div class="upload-group" data-meio="ME" style="display: none;">
                                <label>RelatÃ³rio com EndereÃ§o dos Pontos *</label>
                                <input type="file" name="relatorio_enderecos_me" multiple>
                            </div>
                            <div class="upload-group" data-meio="ME" style="display: none;">
                                <label>Fotos Diurnas (Amostrais) / Noturnas (se iluminado) *</label>
                                <input type="file" name="fotos_pontos_me" multiple>
                            </div>

                            <div class="upload-group" data-meio="MO" style="display: none;">
                                <label>RelatÃ³rio com Listagem de EstaÃ§Ãµes/Linhas/Carros *</label>
                                <input type="file" name="relatorio_estacoes_mo" multiple>
                            </div>
                            <div class="upload-group" data-meio="MO" style="display: none;">
                                <label>Fotos ou VÃ­deos (Amostrais) *</label>
                                <input type="file" name="fotos_videos_mo" multiple>
                            </div>

                            <div class="upload-group" data-meio="BD" style="display: none;">
                                <label>RelatÃ³rio FotogrÃ¡fico de Todos os Ãnibus/Carros *</label>
                                <input type="file" name="comprovante_bd" multiple>
                            </div>
                            <div class="upload-group" data-meio="OD FL" style="display: none;">
                                <label>RelatÃ³rio FotogrÃ¡fico com EndereÃ§o (Diurno/Noturno se iluminado) *</label>
                                <input type="file" name="comprovante_od_fl" multiple>
                            </div>
                            <div class="upload-group" data-meio="MI" style="display: none;">
                                <label>RelatÃ³rio FotogrÃ¡fico de Todos os Pontos e RelaÃ§Ã£o de Locais *</label>
                                <input type="file" name="comprovante_mi" multiple>
                            </div>
                            <div class="upload-group" data-meio="AT CI IN JO RD RV TV TP" style="display: none;">
                                <label>RelatÃ³rio / Comprovante Geral *</label>
                                <input type="file" name="comprovante_geral" multiple>
                            </div>
                        </div>
                        <div class="file-counter" id="fileCounter" style="display: none;"></div>
                    </div>

                    <div class="form-group full-width">
                        <div class="progress-container" id="progressContainer">
                            <div class="progress-bar-wrapper">
                                <div class="progress-text" id="progressText">0%</div>
                                <div class="progress-bar" id="progressBar"></div>
                            </div>
                            <div class="progress-info" id="progressInfo">
                                Preparando envio...
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <button type="submit">Enviar Checking</button>
                    </div>
                </div>
            </form>
            
            <div class="message-box" id="successMessage"></div>
            <div class="message-box" id="errorMessage"></div>
        </div>
    </div>
    
    <footer class="footer-final">
        <div class="logo-principal">GRUPO OM</div>
        <div class="subtitulo">COMUNICAÃÃO INTEGRADA</div>
        <p class="copyright">&copy; 2025 OpusMÃºltipla - Todos os direitos reservados</p>
    </footer>

<script>
    (function () {
        const MAX_SIZE = 500 * 1024 * 1024;
        
        const form = document.getElementById('checkingForm');
        const piInput = document.getElementById('pi');
        const piStatus = document.getElementById('piStatus');
        const clienteInput = document.getElementById('cliente');
        const campanhaInput = document.getElementById('campanha');
        const produtoInput = document.getElementById('produto');
        const periodoInput = document.getElementById('periodo');
        const veiculoInput = document.getElementById('veiculo');
        const meioSelect = document.getElementById('meio');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const submitButton = form.querySelector('button[type="submit"]');
        const uploadArea = document.getElementById('upload-area-dinamica');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const allUploadGroups = uploadArea.querySelectorAll('.upload-group');
        const fileCounter = document.getElementById('fileCounter');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const progressInfo = document.getElementById('progressInfo');

        let piFetchController = null;
        const webhookUrl = 'https://n8n.grupoom.com.br/webhook/CheckingForm';

        function showMessage(element, message) { element.innerHTML = message; element.style.display = 'block'; }
        function clearMessages() { successMessage.style.display = 'none'; errorMessage.style.display = 'none'; }
        
        function updateProgress(percent, info) {
            progressBar.style.width = percent + '%';
            progressText.textContent = percent + '%';
            if (info) progressInfo.innerHTML = info;
        }

        function showProgress() {
            progressContainer.classList.add('active');
            updateProgress(0, 'Iniciando envio...');
        }

        function hideProgress() {
            progressContainer.classList.remove('active');
            updateProgress(0, '');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function checkTotalFileSize() {
            let totalSize = 0;
            let totalFiles = 0;
            
            const visibleFileInputs = uploadArea.querySelectorAll('.upload-group[style*="display: block"] input[type="file"]');
            visibleFileInputs.forEach(input => {
                if (input.files) {
                    for (let i = 0; i < input.files.length; i++) {
                        totalSize += input.files[i].size;
                        totalFiles++;
                    }
                }
            });

            if (totalFiles > 0) {
                fileCounter.textContent = `${totalFiles} arquivo(s) selecionado(s) - ${formatFileSize(totalSize)}`;
                fileCounter.style.display = 'block';
            } else {
                fileCounter.style.display = 'none';
            }
        }

        uploadArea.addEventListener('change', function(e) {
            if (e.target.type === 'file') {
                checkTotalFileSize();
            }
        });
        
        function resetPIFields() {
            const fieldsToReset = { cliente: clienteInput, campanha: campanhaInput, produto: produtoInput, periodo: periodoInput, veiculo: veiculoInput };
            for(const key in fieldsToReset) {
                fieldsToReset[key].value = '';
            }
            meioSelect.value = '';
            atualizarCamposDeAnexo('');
        }

        function atualizarCamposDeAnexo(meio) {
            let algumCampoVisivel = false;
            allUploadGroups.forEach(group => {
                const meiosDoGrupo = group.dataset.meio.split(' ');
                const input = group.querySelector('input[type="file"]');
                if (meio && meiosDoGrupo.includes(meio)) {
                    group.style.display = 'block';
                    if (input) {
                        input.required = true;
                        input.disabled = false;
                    }
                    algumCampoVisivel = true;
                } else {
                    group.style.display = 'none';
                    if (input) {
                        input.required = false;
                        input.value = '';
                    }
                }
            });
            uploadPlaceholder.style.display = algumCampoVisivel ? 'none' : 'block';
            fileCounter.style.display = 'none';
        }

        async function buscarDadosPI(npi) {
            if (!npi) {
                resetPIFields();
                piStatus.textContent = '';
                return;
            }
            if (piFetchController) piFetchController.abort();
            
            piFetchController = new AbortController();
            piStatus.textContent = 'Buscando...';
            piStatus.style.color = '#4a5568';
            clearMessages();
            resetPIFields();

            try {
                const payload = {
                    action: 'buscar_pi',
                    n_pi: npi
                };

                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    signal: piFetchController.signal,
                });
                
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || `Erro de rede ao buscar PI: ${response.status}`);
                }

                if (data.success) {
                    piStatus.textContent = 'Dados carregados com sucesso.';
                    piStatus.style.color = '#10b981';
                    const fieldsToFill = { cliente: clienteInput, campanha: campanhaInput, produto: produtoInput, periodo: periodoInput, veiculo: veiculoInput, meio: meioSelect };
                     for(const key in fieldsToFill) {
                        if(fieldsToFill[key] && data[key] !== undefined) {
                            fieldsToFill[key].value = data[key];
                        }
                    }
                    atualizarCamposDeAnexo(data.meio);
                } else {
                    piStatus.textContent = data.error || 'PI nÃ£o encontrada ou invÃ¡lida.';
                    piStatus.style.color = '#ef4444';
                    resetPIFields();
                }
            } catch (error) {
                if (error.name !== 'AbortError') {
                    piStatus.textContent = 'Falha na comunicaÃ§Ã£o ou PI invÃ¡lida.';
                    piStatus.style.color = '#ef4444';
                    resetPIFields();
                }
            }
        }
        
        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            clearMessages();
            hideProgress();

            let camposAnexoObrigatoriosPreenchidos = true;
            const camposAnexoVisiveis = uploadArea.querySelectorAll('.upload-group[style*="display: block"] input[type="file"]');
            
            camposAnexoVisiveis.forEach(input => {
                if (input.required && input.files.length === 0) {
                    camposAnexoObrigatoriosPreenchidos = false;
                }
            });

            if (!camposAnexoObrigatoriosPreenchidos) {
                showMessage(errorMessage, 'Preencha todos os campos obrigatÃ³rios (*) e anexe pelo menos um arquivo em cada campo de comprovante solicitado.');
                return;
            }

            if (!form.checkValidity()) {
                showMessage(errorMessage, 'Preencha todos os campos obrigatÃ³rios (*).');
                return;
            }

            const originalButtonText = submitButton.textContent;
            submitButton.textContent = 'Enviando...';
            submitButton.disabled = true;
            showProgress();
            
            const formData = new FormData();
            
            formData.append('action', 'submissao_form');
            formData.append('nome', document.getElementById('nome').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('telefone', document.getElementById('telefone').value);
            formData.append('n_pi', document.getElementById('pi').value);
            formData.append('cliente', document.getElementById('cliente').value);
            formData.append('campanha', document.getElementById('campanha').value);
            formData.append('produto', document.getElementById('produto').value);
            formData.append('periodo', document.getElementById('periodo').value);
            formData.append('veiculo', document.getElementById('veiculo').value);
            formData.append('meio', document.getElementById('meio').value);
            formData.append('observacoes', document.getElementById('observacoes').value);
            formData.append('upload_method', 'binary');
            
            let totalSize = 0;
            const allFileInputs = form.querySelectorAll('input[type="file"]');
            allFileInputs.forEach(input => {
                if (input.files.length > 0) {
                    for (let i = 0; i < input.files.length; i++) {
                        formData.append(input.name, input.files[i]);
                        totalSize += input.files[i].size;
                    }
                }
            });
            
            updateProgress(10, `Preparando <strong>${formatFileSize(totalSize)}</strong> para upload...`);

            try {
                const xhr = new XMLHttpRequest();
                
                xhr.upload.addEventListener('progress', function(e) {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);
                        const loaded = formatFileSize(e.loaded);
                        const total = formatFileSize(e.total);
                        updateProgress(percentComplete, `Enviando: <strong>${loaded}</strong> de <strong>${total}</strong>`);
                    }
                });

                xhr.addEventListener('load', function() {
                    try {
                        const result = JSON.parse(xhr.responseText);
                        
                        if (xhr.status !== 200 || !result.success) {
                            throw new Error(result.message || `Erro no servidor: ${xhr.status}`);
                        }
                        
                        updateProgress(100, 'Envio concluÃ­do com sucesso!');
                        setTimeout(() => {
                            showMessage(successMessage, result.message || 'Checking enviado com sucesso!');
                            form.reset();
                            piStatus.textContent = '';
                            resetPIFields();
                            fileCounter.style.display = 'none';
                            hideProgress();
                        }, 1000);
                        
                    } catch (error) {
                        hideProgress();
                        let errorMessageText = 'Ocorreu um erro inesperado.';
                        if (error instanceof SyntaxError) {
                            errorMessageText = 'O servidor retornou uma resposta invÃ¡lida. Contate o suporte.';
                        } else {
                            errorMessageText = error.message;
                        }
                        showMessage(errorMessage, errorMessageText);
                    } finally {
                        submitButton.textContent = originalButtonText;
                        submitButton.disabled = false;
                    }
                });

                xhr.addEventListener('error', function() {
                    hideProgress();
                    showMessage(errorMessage, 'Falha na comunicaÃ§Ã£o com o servidor. Verifique sua conexÃ£o.');
                    submitButton.textContent = originalButtonText;
                    submitButton.disabled = false;
                });

                xhr.addEventListener('timeout', function() {
                    hideProgress();
                    showMessage(errorMessage, 'Tempo esgotado. O arquivo pode ser muito grande.');
                    submitButton.textContent = originalButtonText;
                    submitButton.disabled = false;
                });

                xhr.open('POST', webhookUrl);
                xhr.timeout = 1800000;
                xhr.send(formData);
                
            } catch (error) {
                hideProgress();
                showMessage(errorMessage, 'Ocorreu um erro inesperado.');
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
            }
        });
        
        let debounceTimeout;
        piInput.addEventListener('input', () => {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(() => { buscarDadosPI(piInput.value.trim()); }, 500);
        });

    })();
</script>
</body>
</html>
