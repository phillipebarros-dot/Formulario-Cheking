<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checking OpusM√∫ltipla</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --cor-primaria: #0033a0;
      --cor-secundaria: #1a202c;
      --cor-aviso-fundo: #fefcbf;
      --cor-aviso-texto: #9f580a;
      --cor-aviso-borda: #fce18a;
      --cor-sucesso: #2d8a5b;
      --cor-erro: #c53030;
      --cor-fundo: #f7fafc;
      --cor-borda: #e2e8f0;
    }
    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--cor-fundo);
      margin: 0; padding: 2rem;
      color: var(--cor-secundaria);
    }
    .container {
      background: #fff; border-radius: 12px; box-shadow: 0 10px 20px rgba(0,0,0,.05);
      max-width: 950px; margin: auto; padding: 2.5rem;
    }
    h1 {
      font-family: 'Poppins', sans-serif;
      text-align: center;
      color: var(--cor-primaria);
      font-size: 2rem;
    }
    .attention-box {
      margin-bottom: 2rem;
      text-align: center;
    }
    .attention-box .warning-text {
      background-color: var(--cor-aviso-fundo);
      border: 2px solid var(--cor-aviso-borda);
      color: var(--cor-aviso-texto);
      padding: 1.5rem;
      border-radius: 8px;
      font-weight: 700;
      margin-bottom: 1.5rem;
    }
    .attention-box img {
      max-width: 100%;
      border-radius: 8px;
    }
    form label {
      display: block;
      font-weight: 600;
      margin-top: 1rem;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--cor-borda);
      border-radius: 8px;
      font-family: 'Montserrat', sans-serif;
    }
    input[readonly], .campo-bloqueado {
      background-color: #edf2f7;
      pointer-events: none;
    }
    button {
      background: var(--cor-primaria);
      color: #fff;
      padding: 1rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 1.5rem;
      width: 100%;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .upload-group {
      display: none;
      margin-top: 1rem;
    }
    .size-warning {
      background-color: #fff3cd;
      border: 1px solid #ffc107;
      color: #856404;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      display: none;
      font-weight: 600;
    }
    .drive-link-section {
      display: none;
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 1rem;
    }
    .message {
      font-weight: 600;
      text-align: center;
      margin-top: 1rem;
      display: none;
    }
    #successMessage { color: var(--cor-sucesso); }
    #errorMessage { color: var(--cor-erro); }
  </style>
</head>
<body>
  <div class="container">
    <h1>CHECKING OPUSM√öLTIPLA</h1>

    <div class="attention-box">
      <div class="warning-text">
        S√ì ACEITAREMOS CHECKINGS POR ARQUIVOS, LINKS N√ÉO SER√ÉO PERMITIDOS (exceto acima de 500MB).<br>
        O n√£o envio dos relat√≥rios de acordo com especifica√ß√µes acarretar√° no n√£o pagamento das veicula√ß√µes.
      </div>
      <img src="comunicado.jpg" alt="Comunicado">
    </div>

    <form id="checkingForm" novalidate>
      <label>Nome *</label>
      <input type="text" name="nome" required>

      <label>E-mail *</label>
      <input type="email" name="email" required>

      <label>Telefone *</label>
      <input type="tel" name="telefone" required>

      <label>N√∫mero da PI *</label>
      <input type="text" id="pi" name="n_pi" required>
      <div id="piStatus"></div>

      <label>Cliente</label>
      <input type="text" id="cliente" name="cliente" readonly>

      <label>Campanha</label>
      <input type="text" id="campanha" name="campanha" readonly>

      <label>Produto</label>
      <input type="text" id="produto" name="produto" readonly>

      <label>Per√≠odo</label>
      <input type="text" id="periodo" name="periodo" readonly>

      <label>Ve√≠culo</label>
      <input type="text" id="veiculo" name="veiculo" readonly>

      <label>Meio</label>
      <select id="meio" name="meio" class="campo-bloqueado">
        <option value="">Aguardando PI...</option>
        <option value="DO">Digital Out of Home</option>
        <option value="ME">M√≠dia Externa</option>
        <option value="MO">Metr√¥</option>
        <option value="BD">Busdoor</option>
        <option value="OD">Outdoor</option>
        <option value="FL">Frontlight</option>
        <option value="MI">M√≠dia Interna</option>
        <option value="RD">R√°dio</option>
        <option value="TP">Patroc√≠nios</option>
        <option value="CI">Cinema</option>
        <option value="JO">Jornal</option>
        <option value="RV">Revista</option>
        <option value="AT">Ativa√ß√£o</option>
        <option value="TV">Televis√£o</option>
        <option value="IN">Internet</option>
      </select>

      <p id="upload-placeholder">Preencha a PI para exibir os campos de anexo.</p>

      <!-- Campos de upload -->
      <div class="upload-group" data-meio="DO">
        <label>Relat√≥rio Fotogr√°fico *</label>
        <input type="file" name="relatorio_fotografico_do" multiple>
      </div>
      <div class="upload-group" data-meio="DO">
        <label>Relat√≥rio de Exibi√ß√µes *</label>
        <input type="file" name="relatorio_exibicoes_do" multiple>
      </div>
      <div class="upload-group" data-meio="DO">
        <label>V√≠deo Diurno *</label>
        <input type="file" name="video_diurno_do" multiple>
      </div>

      <div class="upload-group" data-meio="ME">
        <label>Relat√≥rio com Endere√ßo *</label>
        <input type="file" name="relatorio_enderecos_me" multiple>
      </div>
      <div class="upload-group" data-meio="ME">
        <label>Fotos Diurnas/Noturnas *</label>
        <input type="file" name="fotos_pontos_me" multiple>
      </div>

      <div class="upload-group" data-meio="MO">
        <label>Relat√≥rio Esta√ß√µes *</label>
        <input type="file" name="relatorio_estacoes_mo" multiple>
      </div>
      <div class="upload-group" data-meio="MO">
        <label>Fotos/V√≠deos *</label>
        <input type="file" name="fotos_videos_mo" multiple>
      </div>

      <div class="upload-group" data-meio="OD FL BD MI RD TP CI JO RV AT TV IN">
        <label>Comprovante *</label>
        <input type="file" name="comprovante_unico" multiple>
      </div>

      <div class="size-warning" id="sizeWarning">
        ‚ö†Ô∏è Tamanho total excede 500MB! Use o link do Drive.
      </div>

      <div class="drive-link-section" id="driveLinkSection">
        <h3>üìÅ Link do Google Drive</h3>
        <p>Fa√ßa upload dos arquivos e cole o link abaixo (pasta p√∫blica):</p>
        <input type="url" name="drive_link" placeholder="https://drive.google.com/drive/folders/...">
      </div>

      <button type="submit">Enviar Checking</button>
    </form>

    <div class="message" id="successMessage"></div>
    <div class="message" id="errorMessage"></div>
  </div>

<script>
(function() {
  const MAX_SIZE = 500 * 1024 * 1024;
  const webhookUrl = "https://n8n.grupoom.com.br/webhook/CheckingForm";

  const form = document.getElementById('checkingForm');
  const meioSelect = document.getElementById('meio');
  const uploadGroups = document.querySelectorAll('.upload-group');
  const sizeWarning = document.getElementById('sizeWarning');
  const driveSection = document.getElementById('driveLinkSection');
  const successMessage = document.getElementById('successMessage');
  const errorMessage = document.getElementById('errorMessage');
  const submitButton = form.querySelector('button[type="submit"]');

  function updateUploads(meio) {
    let visible = false;
    uploadGroups.forEach(g => {
      const meios = g.dataset.meio.split(' ');
      if (meios.includes(meio)) {
        g.style.display = 'block';
        visible = true;
      } else g.style.display = 'none';
    });
    document.getElementById('upload-placeholder').style.display = visible ? 'none' : 'block';
  }

  function checkSize() {
    let total = 0;
    document.querySelectorAll('input[type="file"]').forEach(f => {
      for (const file of f.files) total += file.size;
    });
    const over = total > MAX_SIZE;
    sizeWarning.style.display = over ? 'block' : 'none';
    driveSection.style.display = over ? 'block' : 'none';
    document.querySelectorAll('input[type="file"]').forEach(f => f.disabled = over);
  }

  form.addEventListener('change', checkSize);
  meioSelect.addEventListener('change', e => updateUploads(e.target.value));

  form.addEventListener('submit', async e => {
    e.preventDefault();
    successMessage.style.display = errorMessage.style.display = 'none';

    const usandoLink = driveSection.style.display === 'block';
    const formData = new FormData(form);
    formData.append('upload_method', usandoLink ? 'drive_link' : 'binary');
    formData.append('action', 'submissao_form');

    submitButton.disabled = true;
    submitButton.textContent = 'Enviando...';

    try {
      const res = await fetch(webhookUrl, { method: 'POST', body: formData });
      const json = await res.json();
      if (!json.success) throw new Error(json.message);
      successMessage.textContent = '‚úÖ Enviado com sucesso!';
      successMessage.style.display = 'block';
      form.reset();
      updateUploads('');
      checkSize();
    } catch (err) {
      errorMessage.textContent = err.message || 'Erro inesperado.';
      errorMessage.style.display = 'block';
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = 'Enviar Checking';
    }
  });
})();
</script>
</body>
</html>
