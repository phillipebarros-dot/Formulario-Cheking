Etapa 1: Exportar o Arquivo do Workflow do n8n
Primeiro, voc√™ precisa pegar o "c√≥digo" do seu workflow. O n8n exporta isso como um arquivo JSON.

Abra seu workflow na interface do n8n.

No canto superior esquerdo, clique no menu "File" (ou "Arquivo").

V√° em "Export" -> "Export to File".

Selecione "JSON" como o formato.

Salve o arquivo no seu computador. Renomeie-o para workflow.json para manter um padr√£o.

Etapa 2: Adicionar o workflow.json ao GitHub
Agora, vamos fazer o upload desse arquivo para o seu reposit√≥rio.

Acesse seu reposit√≥rio no GitHub: https://github.com/phillipebarros-dot/Formulario-Cheking

Clique no bot√£o "Add file" e depois em "Upload files".

Arraste o arquivo workflow.json que voc√™ acabou de salvar para a √°rea de upload.

No campo de mensagem do commit, escreva algo como: Adiciona arquivo JSON do workflow n8n.

Clique em "Commit changes".

Etapa 3: Criar a Documenta√ß√£o Detalhada (WORKFLOW.md)
Este novo arquivo ser√° o manual t√©cnico do seu workflow.

Na p√°gina principal do seu reposit√≥rio, clique em "Add file" e depois em "Create new file".

No campo para o nome do arquivo, no topo da p√°gina, digite: WORKFLOW.md

No campo grande de edi√ß√£o de texto, copie e cole todo o conte√∫do do bloco de c√≥digo abaixo.

No campo de mensagem do commit, escreva: Cria documenta√ß√£o t√©cnica detalhada do workflow.

Clique em "Commit changes".

Conte√∫do para o Arquivo WORKFLOW.md (Copie tudo abaixo)
Markdown

# An√°lise T√©cnica do Workflow n8n - Checking OpusM√∫ltipla

Este documento oferece uma an√°lise t√©cnica detalhada, n√≥ por n√≥, do workflow de automa√ß√£o do formul√°rio de checking. O objetivo √© servir como um manual para manuten√ß√£o, depura√ß√£o e futuras evolu√ß√µes do processo.

### Fluxo Geral da Automa√ß√£o

`Formul√°rio Web` ‚ûî `1. Webhook` ‚ûî `2. Identificar A√ß√£o` ‚ûî `3. IF A√ß√£o` ‚ûî `[Rota de Busca]` OU `[Rota de Envio Completo]`

---

## An√°lise Detalhada dos N√≥s (Node-by-Node)

### 1. Webhook (Recebe do Front-End)
* **Tipo de N√≥:** Webhook
* **Objetivo:** √â a porta de entrada da automa√ß√£o. Ele gera uma URL √∫nica que fica "escutando" as requisi√ß√µes enviadas pelo formul√°rio `index.html`.
* **Configura√ß√£o Chave:**
    * **HTTP Method:** `POST` - Permite o recebimento de dados, incluindo arquivos.
    * **Path:** `CheckingForm` - Define o endere√ßo final da URL (ex: `.../webhook/CheckingForm`).
    * **Response Mode:** `responseNode` - Permite que um n√≥ espec√≠fico (`Respond to Webhook`) envie a resposta de volta ao formul√°rio, em vez do pr√≥prio Webhook.

### 2. Identificar A√ß√£o
* **Tipo de N√≥:** Function (Code)
* **Objetivo:** Atua como um "tradutor" da inten√ß√£o do usu√°rio. Ele inspeciona os dados recebidos para determinar se a requisi√ß√£o √© uma simples busca de PI ou uma submiss√£o de formul√°rio completa.
* **Configura√ß√£o Chave (C√≥digo JavaScript):**
    ```javascript
    const body = $json.body || {};
    if (body.action === 'buscar_pi') {
      // Se for uma busca, cria um item simples com o tipo 'buscar_pi'
      return [{ json: { tipo: 'buscar_pi', n_pi: body.n_pi } }];
    } else {
      // Para qualquer outra coisa (a submiss√£o), cria um item com o tipo 'submissao'
      // e anexa todos os dados originais da requisi√ß√£o.
      return [{ json: { tipo: 'submissao', dados: $item.json } }];
    }
    ```

### 3. IF A√ß√£o
* **Tipo de N√≥:** IF
* **Objetivo:** √â o principal roteador do workflow. Com base na sa√≠da do n√≥ anterior, ele direciona a execu√ß√£o para o caminho correto.
* **Configura√ß√£o Chave:**
    * **Condi√ß√£o:** Verifica se o campo `tipo` √© igual a `buscar_pi`.
    * **Sa√≠da `true`:** Leva para a **Rota de Busca**.
    * **Sa√≠da `false`:** Leva para a **Rota de Envio Completo**.

---

### Rota de Busca (Sa√≠da `true` do n√≥ "IF A√ß√£o")

Este √© um fluxo curto e r√°pido, projetado apenas para devolver informa√ß√µes ao formul√°rio.

#### 4a. Buscar PI (dados)
* **Tipo de N√≥:** Google Sheets
* **Objetivo:** Consultar a planilha para verificar se a PI existe e buscar seus dados.
* **Configura√ß√£o Chave:**
    * **Operation:** `Get Many` (Ler linhas).
    * **Sheet:** Aba `base`.
    * **Filters:** `N_PI` (coluna) `Equals` `{{$json.n_pi}}` (valor vindo do formul√°rio).

#### 5a. Montar Resposta PI
* **Tipo de N√≥:** Function (Code)
* **Objetivo:** Formatar a resposta que ser√° enviada de volta ao formul√°rio.
* **Configura√ß√£o Chave (C√≥digo JavaScript):**
    ```javascript
    const piData = $json; // Dados da planilha
    if (!piData || Object.keys(piData).length <= 1) {
      // Se n√£o encontrou dados, retorna um JSON de erro.
      return [{ json: { error: 'PI n√£o encontrada' } }];
    }
    // Se encontrou, retorna um JSON de sucesso com os dados formatados.
    return [{
      json: {
        success: true,
        cliente: piData.CLIENTE || '',
        campanha: piData.CAMPANHA || '',
        produto: piData.PRODUTO || '',
        periodo: piData.PERIODO || '',
        veiculo: piData.VEICULO || '',
        meio: piData.MEIO || ''
      }
    }];
    ```

#### 6a. Responder Dados PI
* **Tipo de N√≥:** Respond to Webhook
* **Objetivo:** Enviar a resposta (JSON de sucesso ou erro) de volta para o JavaScript do formul√°rio e **terminar esta execu√ß√£o do workflow**.

---

### Rota de Envio Completo (Sa√≠da `false` do n√≥ "IF A√ß√£o")

Este √© o fluxo principal que executa todas as regras de neg√≥cio.

#### 4b. Buscar PI (submissao)
* **Tipo de N√≥:** Google Sheets
* **Objetivo:** Revalidar a exist√™ncia da PI e obter os dados para uso posterior (como o nome do cliente para o e-mail).
* **Configura√ß√£o Chave:**
    * **Filters:** `N_PI` (coluna) `Equals` `{{$json.dados.body.n_pi}}` (valor vindo do formul√°rio completo).

#### 5b. Verificar PI Existe
* **Tipo de N√≥:** IF
* **Objetivo:** Parar o fluxo se a PI enviada no formul√°rio final n√£o existir.
* **Configura√ß√£o Chave:**
    * **Condi√ß√£o:** Verifica se o n√∫mero de resultados da busca anterior √© igual a 0.
    * **Sa√≠da `true`:** Leva a um n√≥ de erro (n√£o detalhado aqui, mas encerraria o fluxo).
    * **Sa√≠da `false`:** Permite que o fluxo continue.

#### 6b. Validar Status PI
* **Tipo de N√≥:** Function (Code)
* **Objetivo:** Garantir que o checking s√≥ seja aceito para PIs com status "ativa".
* **Configura√ß√£o Chave (C√≥digo JavaScript):**
    ```javascript
    const piData = $json;
    if (!piData.Status || piData.Status.toLowerCase() !== 'ativa') {
      throw new Error('A PI informada n√£o est√° ativa e n√£o pode receber checkings.');
    }
    return $json;
    ```
    *Se a condi√ß√£o for verdadeira, o `throw new Error` interrompe o workflow e retorna uma mensagem de erro ao usu√°rio.*

#### 7b. Valida√ß√µes de Anexos (Cadeia de IFs e Functions)
* **Tipo de N√≥s:** IF, Function
* **Objetivo:** Verificar se a quantidade de arquivos enviados atende ao m√≠nimo exigido para cada tipo de "Meio".
* **Configura√ß√£o Chave:**
    * **IFs:** Verificam o valor de `$json.dados.body.meio` (ex: "DO", "ME").
    * **Functions:** Cont√™m a l√≥gica que conta o n√∫mero de anexos e usa `throw new Error` se a contagem for menor que a necess√°ria.

#### 8b. Criar Pasta PI
* **Tipo de N√≥:** Google Drive
* **Objetivo:** Criar uma pasta √∫nica e padronizada para armazenar os comprovantes.
* **Configura√ß√£o Chave:**
    * **Operation:** `Create Folder`.
    * **Name:** Express√£o din√¢mica para nomear a pasta (ex: `PI_{{$json.dados.body.n_pi}}`).

#### 9b. Upload Arquivos
* **Tipo de N√≥:** Google Drive
* **Objetivo:** Salvar os arquivos enviados pelo usu√°rio na pasta rec√©m-criada.
* **Configura√ß√£o Chave:**
    * **Operation:** `Upload File`.
    * **Binary Property:** `dados.binary.comprovantes` - Aponta para os dados dos arquivos recebidos pelo Webhook.
    * **Parent Folder ID:** Usa o ID da pasta criada no n√≥ anterior.

#### 10b. Registrar Log
* **Tipo de N√≥:** Google Sheets
* **Objetivo:** Criar uma trilha de auditoria, registrando cada submiss√£o bem-sucedida.
* **Configura√ß√£o Chave:**
    * **Operation:** `Append` (Adicionar linha).
    * **Sheet:** Aba `Log_Checkings`.
    * **Columns:** Mapeia os dados relevantes (`PI`, `Cliente`, `Data`, `Qtd_Arquivos`, etc.) para as colunas da planilha.

#### 11b. Enviar Notifica√ß√£o
* **Tipo de N√≥:** Send Email
* **Objetivo:** Comunicar √† equipe interna que um novo checking foi recebido e processado.
* **Configura√ß√£o Chave:**
    * **To/From:** Endere√ßos de e-mail dos destinat√°rios.
    * **Subject/Body:** Conte√∫do do e-mail, usando express√µes para inserir dados din√¢micos como o n√∫mero da PI e o nome do cliente.

#### 12b. Responder Sucesso
* **Tipo de N√≥:** Respond to Webhook
* **Objetivo:** Enviar a mensagem final de sucesso de volta para o formul√°rio e **terminar esta execu√ß√£o do workflow**.
  
Etapa 4: Lincar a Nova Documenta√ß√£o no README.md (Recomendado)
Para que as pessoas encontrem essa documenta√ß√£o t√©cnica facilmente, adicione um link para ela no seu arquivo README.md principal.

Edite seu arquivo README.md.

Encontre a se√ß√£o ## ü§ñ Como Funciona a Automa√ß√£o (n8n).

No final dessa se√ß√£o, adicione a seguinte linha:

Para uma an√°lise t√©cnica detalhada de cada n√≥ do workflow, [consulte a documenta√ß√£o completa aqui](./WORKFLOW.md).
